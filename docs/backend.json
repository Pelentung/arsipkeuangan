
{
  "entities": {
    "Contract": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contract",
      "type": "object",
      "description": "Represents a contract document and its associated metadata.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Contract entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the contract."
        },
        "parties": {
          "type": "array",
          "description": "The parties involved in the contract. (Relationship: Contract 1:N Party)",
          "items": {
            "type": "string"
          }
        },
        "effectiveDate": {
          "type": "string",
          "description": "The date the contract becomes effective.",
          "format": "date-time"
        },
        "expirationDate": {
          "type": "string",
          "description": "The date the contract expires.",
          "format": "date-time"
        },
        "terms": {
          "type": "string",
          "description": "Key terms and conditions of the contract."
        },
        "documentUrl": {
          "type": "string",
          "description": "URL or path to the contract document stored in Firebase Storage.",
          "format": "uri"
        },
        "summary": {
          "type": "string",
          "description": "AI-generated summary of the contract terms."
        },
        "reminderIds": {
          "type": "array",
          "description": "References to Reminders associated with this contract. (Relationship: Contract 1:N Reminder)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "parties",
        "effectiveDate",
        "expirationDate",
        "terms",
        "documentUrl"
      ]
    },
    "Reminder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reminder",
      "type": "object",
      "description": "Represents a reminder for important dates related to a contract.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Reminder entity."
        },
        "contractId": {
          "type": "string",
          "description": "Reference to the Contract this reminder is for. (Relationship: Contract 1:N Reminder)"
        },
        "reminderDate": {
          "type": "string",
          "description": "The date and time the reminder should be triggered.",
          "format": "date-time"
        },
        "message": {
          "type": "string",
          "description": "The message to be displayed when the reminder is triggered."
        }
      },
      "required": [
        "id",
        "contractId",
        "reminderDate",
        "message"
      ]
    },
    "Party": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Party",
      "type": "object",
      "description": "Represents a party involved in a contract.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Party entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the party."
        },
        "contactInformation": {
          "type": "string",
          "description": "Contact details for the party, such as address, phone number, or email."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/contracts/{contractId}",
        "definition": {
          "entityName": "Contract",
          "schema": {
            "$ref": "#/backend/entities/Contract"
          },
          "description": "Stores contract documents owned by a specific user. Ensures that each user can only access their own contracts. Path-based ownership ensures secure `list` operations. Authorization relies solely on `request.auth.uid` matching the `userId`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the contract."
            },
            {
              "name": "contractId",
              "description": "The unique identifier of the contract document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/contracts/{contractId}/reminders/{reminderId}",
        "definition": {
          "entityName": "Reminder",
          "schema": {
            "$ref": "#/backend/entities/Reminder"
          },
          "description": "Stores reminders associated with a specific contract.  Since this is a subcollection owned by a contract and user, authorization is determined by the parent `contractId` and `userId` relationship.  Path-based ownership ensures that only the contract owner can access the reminders.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who owns the contract."
            },
            {
              "name": "contractId",
              "description": "The unique identifier of the contract document."
            },
            {
              "name": "reminderId",
              "description": "The unique identifier of the reminder document."
            }
          ]
        }
      },
      {
        "path": "/parties/{partyId}",
        "definition": {
          "entityName": "Party",
          "schema": {
            "$ref": "#/backend/entities/Party"
          },
          "description": "Stores information about parties involved in contracts. Parties are global and any user can read any parties.",
          "params": [
            {
              "name": "partyId",
              "description": "The unique identifier of the party."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to securely store contract data and related metadata. It prioritizes authorization independence by denormalizing user roles and access control information where necessary, avoiding complex `get()` calls in security rules. The structure also supports query optimization and efficient data retrieval. The path-based ownership `/users/{userId}/contracts/{contractId}` structure enables secure `list` operations by ensuring that users can only list contracts they own. Denormalizing ownership into subcollections is avoided for simplicity in this scenario.  The segregation of Contract, Reminder, and Party data into separate collections facilitates focused queries and simplifies security rules by ensuring a homogenous security posture within each collection. Specifically, access to Contracts and Parties are limited to authorized users via path-based ownership and role-based access. The structure also facilitates easy filtering and searching of contracts based on metadata fields such as parties, effective date, and expiration date. Reminders are structured as subcollections under contracts to ensure proper scoping and ownership. The structure facilitates QAPs by leveraging path-based ownership."
  }
}
